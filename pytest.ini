[tool:pytest]
# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Async configuration
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Coverage configuration
addopts = 
    -v
    --strict-markers
    --tb=short
    --cov=api
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-branch
    --cov-fail-under=100

# Test markers - Big Tech style categorization
markers =
    # Test Pyramid Levels
    unit: Unit tests - Fast, isolated, no external deps (70% of suite)
    integration: Integration tests - DB, cache, external APIs (20% of suite)
    e2e: End-to-end tests - Full user flows (10% of suite)
    
    # Test Types
    contract: Contract tests - API schema compatibility
    property: Property-based tests - Hypothesis generated
    mutation: Mutation tests - Verify test robustness
    performance: Performance benchmarks
    security: Security tests
    
    # Speed markers
    slow: Tests > 1s (run selectively)
    fast: Tests < 100ms (run always)
    
    # Feature markers
    lead: Lead management tests
    pricing: Pricing engine tests
    proposal: Proposal generation tests
    webhook: Webhook integration tests

# Warning filters
filterwarnings =
    ignore::DeprecationWarning:pydantic.*
    ignore::DeprecationWarning:slowapi.*
    ignore::DeprecationWarning:sqlalchemy.*
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning

# Hypothesis configuration
hypothesis_profile = ci

[hypothesis]
# CI profile - faster execution
deadline = 500
max_examples = 100
stateful_step_count = 50
